import streamlit as st
import pandas as pd

# 1. ページ設定
st.set_page_config(page_title="学区・教育環境ナビ", layout="wide")

# CSS: 固定デザイン・中央揃え
st.markdown("""
    <style>
    header { visibility: hidden; }
    .block-container { padding-top: 1rem !important; overflow: visible !important; }
    
    .main-header { 
        font-size: 24px; font-weight: bold; color: #1a365d; 
        text-align: center; border-bottom: 3px solid #3498db;
        padding-bottom: 10px; margin-bottom: 15px; 
    }

    .highlight-box {
        background-color: #f8fafc;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e2e8f0;
        margin-bottom: 20px;
    }
    
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th { 
        background-color: #f2f2f2; 
        text-align: center !important; 
        padding: 10px; 
        font-size: 14px;
        border-bottom: 2px solid #ddd;
    }
    td { 
        border-bottom: 1px solid #ddd; 
        padding: 10px; 
        text-align: center !important; 
        font-size: 14px;
    }
    </style>
""", unsafe_allow_html=True)

st.markdown('<div class="main-header">🏫 学区・教育環境ガイド</div>', unsafe_allow_html=True)

# --- データ1: 私立中学（各7校） ---
school_data = [
    # 男子校 (7校)
    {"順位": 1, "学校名": "開成中学校", "偏差値": 72, "カテゴリ": "男子校", "所在地": "荒川区", "最寄り": "西日暮里"},
    {"順位": 2, "学校名": "麻布中学校", "偏差値": 68, "カテゴリ": "男子校", "所在地": "港区", "最寄り": "広尾"},
    {"順位": 3, "学校名": "駒場東邦中学校", "偏差値": 67, "カテゴリ": "男子校", "所在地": "世田谷区", "最寄り": "駒場東大前"},
    {"順位": 4, "学校名": "武蔵中学校", "偏差値": 65, "カテゴリ": "男子校", "所在地": "練馬区", "最寄り": "江古田"},
    {"順位": 5, "学校名": "海城中学校", "偏差値": 64, "カテゴリ": "男子校", "所在地": "新宿区", "最寄り": "新大久保"},
    {"順位": 6, "学校名": "早稲田中学校", "偏差値": 64, "カテゴリ": "男子校", "所在地": "新宿区", "最寄り": "早稲田"},
    {"順位": 7, "学校名": "本郷中学校", "偏差値": 60, "カテゴリ": "男子校", "所在地": "豊島区", "最寄り": "巣鴨"},
    
    # 女子校 (7校)
    {"順位": 1, "学校名": "桜蔭中学校", "偏差値": 71, "カテゴリ": "女子校", "所在地": "文京区", "最寄り": "水道橋"},
    {"順位": 2, "学校名": "女子学院中学校", "偏差値": 69, "カテゴリ": "女子校", "所在地": "千代田区", "最寄り": "市ヶ谷"},
    {"順位": 3, "学校名": "豊島岡女子学園", "偏差値": 68, "カテゴリ": "女子校", "所在地": "豊島区", "最寄り": "池袋"},
    {"順位": 4, "学校名": "雙葉中学校", "偏差値": 67, "カテゴリ": "女子校", "所在地": "千代田区", "最寄り": "四ツ谷"},
    {"順位": 5, "学校名": "白百合学園", "偏差値": 64, "カテゴリ": "女子校", "所在地": "千代田区", "最寄り": "九段下"},
    {"順位": 6, "学校名": "吉祥女子中学校", "偏差値": 63, "カテゴリ": "女子校", "所在地": "武蔵野市", "最寄り": "吉祥寺"},
    {"順位": 7, "学校名": "鴎友学園女子", "偏差値": 62, "カテゴリ": "女子校", "所在地": "世田谷区", "最寄り": "宮の坂"},
    
    # 共学 (7校)
    {"順位": 1, "学校名": "渋谷教育学園渋谷", "偏差値": 70, "カテゴリ": "共学", "所在地": "渋谷区", "最寄り": "渋谷"},
    {"順位": 2, "学校名": "筑波大学附属", "偏差値": 69, "カテゴリ": "共学", "所在地": "文京区", "最寄り": "護国寺"},
    {"順位": 3, "学校名": "広尾学園", "偏差値": 66, "カテゴリ": "共学", "所在地": "港区", "最寄り": "広尾"},
    {"順位": 4, "学校名": "慶應義塾中等部", "偏差値": 65, "カテゴリ": "共学", "所在地": "港区", "最寄り": "三田"},
    {"順位": 5, "学校名": "早稲田実業学校", "偏差値": 65, "カテゴリ": "共学", "所在地": "国分寺市", "最寄り": "国分寺"},
    {"順位": 6, "学校名": "芝浦工業大学附属", "偏差値": 62, "カテゴリ": "共学", "所在地": "江東区", "最寄り": "豊洲"},
    {"順位": 7, "学校名": "三田国際学園", "偏差値": 61, "カテゴリ": "共学", "所在地": "世田谷区", "最寄り": "用賀"},
]

# --- 23区データ (詳細拡充版) ---
ward_data = [
    {
        "No": 1, "区": "千代田区", 
        "教育特色": "「誰一人取り残さない」ICT教育を推進。全小中学校に専任のICT支援員を配置し、プログラミング教育の質が非常に高い。中高一貫の区立九段中等教育学校は倍率が高く人気。",
        "独自支援": "「次世代育成手当」として高校生まで月5,000円を独自支給。誕生祝金（4.5万円〜）や、独自の奨学金制度も充実しており、教育・福祉への予算投入額は23区トップクラス。"
    },
    {
        "No": 2, "区": "中央区", 
        "教育特色": "晴海フラッグ等の人口急増に伴い最新設備を備えた校舎を新設。放課後遊び場「プレディ」を全校で実施。地域住民が講師となる「土曜学習支援」も定着している。",
        "独自支援": "「新生児誕生祝品」として3万円分のタクシー券や区内共通買物券を配布。第2子以降の保育料完全無償化をいち早く実施し、共働き世帯への住宅補助相談も手厚い。"
    },
    {
        "No": 3, "区": "港区", 
        "教育特色": "国際理解教育に注力。全校にネイティブ講師を配置し「英語で学ぶ」環境を提供。独自の小中一貫教育校（白金の丘等）や、ICT環境を活用した反転学習を導入。",
        "独自支援": "「出産費用助成」が23区最高額（最大60万円）。私立幼稚園への入園料補助（最大10万円）や、港区独自の「子育て応援商品券」配布など、高所得世帯への支援も手厚い。"
    },
    {
        "No": 4, "区": "新宿区", 
        "教育特色": "多文化共生。日本語指導が必要な児童へのフォローが23区で最も手厚い。夏休みの学習支援教室や、ICTを活用した放課後学習システム「スタディサプリ」の全戸導入も話題。",
        "独自支援": "「誕生お祝い品」やベビー用品の配布、さらには「子どもショートステイ」制度が充実しており、急な仕事や体調不良時の預かり先が確保しやすい点が評価されている。"
    },
    {
        "No": 5, "区": "文京区", 
        "教育特色": "「教育の府」。御三家（誠之・昭和・千駄木・窪町）を筆頭に公立小のレベルが極めて高く、中学受験塾へ通う比率が都内最高。国立大附属校も多く教育熱心な層が集中。",
        "独自支援": "「文京区版ネウボラ」による伴走支援。教育格差を埋める支援が充実。教育相談センターのカウンセリング体制は非常に質が高く、不登校対策や心のケアも先行している。"
    },
    {
        "No": 6, "区": "台東区", 
        "教育特色": "博物館や美術館（上野）と連携した「本物の文化体験教育」が特色。伝統工芸を学ぶ授業も多く、下町文化を尊重した教育を展開。",
        "独自支援": "「小学校・中学校入学お祝い金」を支給。さらに「子育て世帯家賃助成」があり、ファミリー世帯の定住を強力にサポート。"
    },
    {
        "No": 7, "区": "墨田区", 
        "教育特色": "ものづくり体験教育。地場産業と連携したキャリア教育が盛ん。公立小中学校の改築を進めており、木のぬくもりを感じる校舎やオープンスペースを活かした授業を展開。",
        "独自支援": "「すみだ型ネウボラ」を推進。妊娠期から就学前まで担当保健師が継続サポート。私立幼稚園の保育料補助が他区より手厚い傾向にある。"
    },
    {
        "No": 8, "区": "江東区", 
        "教育特色": "湾岸エリアを中心に最新教育設備を導入。理数系教育に力を入れる取り組みや、土曜塾の開催、不登校児童へのケアが充実。",
        "独自支援": "待機児童ゼロを達成。第2子以降の保育料無償化に加え、私立幼稚園等への入園料助成金を増額。区独自のアプリでの情報発信も迅速。"
    },
    {
        "No": 9, "区": "品川区", 
        "教育特色": "「小中一貫教育」の先駆者。4-3-2制のカリキュラムを導入。英語教育「市民科」という独自の教科で、論理的思考力とプレゼン力を育てる教育が定評。",
        "独自支援": "「しながわネウボラネットワーク」により、全ての妊産婦に育児用品を配布。地域資源を活かした独自の預かり機能が強い。"
    },
    {
        "No": 10, "区": "目黒区", 
        "教育特色": "「目黒区版教育の情報化」。全校に電子黒板とタブレットを完備し、思考力の可視化を重視。自由が丘や駒場エリアなど教育意識の高い地域。",
        "独自支援": "子育て支援センター「ほっぺ」が非常に充実。一時預かりのオンライン予約が便利。産後ケアの利用料助成が手厚い。"
    },
    {
        "No": 11, "区": "大田区", 
        "教育特色": "理数教育の重点化。町工場と連携した科学体験授業を実施。全校で「放課後ひろば」を実施し、共働き世帯の居場所を確保。",
        "独自支援": "子育てひろば「ぴよぴよ」を各地域に配置。第3子以降の出産祝金や、独自の家賃助成（条件あり）など経済的支援も継続。"
    },
    {
        "No": 12, "区": "世田谷区", 
        "教育特色": "「せたがやの教育」。公立校の自主性を重んじ、独自の「日本語教育」や食育に定評。学校運営に地域が関わるコミュニティ・スクールも盛ん。",
        "独自支援": "「せたがや子育て利用券」を配布。児童館の数が23区随一で、放課後や休日の遊び場が豊富。産後ケア体制も強固。"
    },
    {
        "No": 13, "区": "渋谷区", 
        "教育特色": "「シブヤ・スマート教育」。1人1台のセルラーモデルタブレットを配布。民間企業と提携した高度なプログラミング教育を実施。",
        "独自支援": "「ハッピーマザー出産助成金」として10万円を上乗せ支給。育児用品レンタル補助など、ITを駆使したスマートな支援が特徴。"
    },
    {
        "No": 14, "区": "中野区", 
        "教育特色": "「中野型ICT教育」。情報モラル教育に注力。公立小中学校の再編に合わせ、全校で最新のラーニングコモンズを設置。",
        "独自支援": "「子育て応援ギフト」として計10万円を支給。ブックスタート（絵本配布）に加え、セカンドブック（2歳児向け）も実施。"
    },
    {
        "No": 15, "区": "杉並区", 
        "教育特色": "「すぎなみ教育プラン」。習熟度別学習や少人数授業を徹底。中学受験率も安定して高く、保護者の教育意識に合わせた開かれた学校づくりを推進。",
        "独自支援": "「すぎなみ子育て応援券（最大4万円分）」が有名。一時預かりや家事支援、ベビーマッサージ等に利用可能。"
    },
    {
        "No": 16, "区": "豊島区", 
        "教育特色": "教育に最優先投資。最新の校舎改築、放課後の「スキップ」での学習支援、SDGs教育を軸としたグローバル人材育成を推進。",
        "独自支援": "「待機児童ゼロ」を長年継続。多子世帯への保育料軽減が手厚く、所得制限なしで第2子以降無償化も実施。"
    },
    {
        "No": 17, "区": "北区", 
        "教育特色": "独自の「学習診断テスト」を実施し、分析に基づいた補習を展開。部活動の地域連携も進んでおり、文武両道を掲げる。",
        "独自支援": "「安心ママパパ応援団」による安価な家事育児支援。第3子以降の義務教育期間中の給食費無償化をいち早く導入。"
    },
    {
        "No": 18, "区": "荒川区", 
        "教育特色": "「読書のまち」。専任司書の配置が徹底されており、学校図書館の充実度は随一。全国学力調査の成績が近年急上昇中。",
        "独自支援": "多子世帯への「おむつ専用ごみ袋」無料配布や、独自の塾代助成制度（中学生対象）など、家計に直結する支援が多い。"
    },
    {
        "No": 19, "区": "板橋区", 
        "教育特色": "イタリアのレッジョ・エミリア教育を取り入れた先進的な幼児教育を推進。全校でのコミュニティ・スクール化が完了。",
        "独自支援": "「すくすくカード」で有料支援サービスを利用可能。第2子以降の保育料完全無償化。公園内での遊び場づくりも活発。"
    },
    {
        "No": 20, "区": "練馬区", 
        "教育特色": "公立小中学校数が23区最多。ICT活用と伝統的な読み書き計算を重視するバランスの良い教育で、学力水準が非常に安定。",
        "独自支援": "「第3子誕生祝金（10万円）」を支給。幼稚園での預かり保育「練馬こども園」認定を拡大しており、幼稚園派にも優しい。"
    },
    {
        "No": 21, "区": "足立区", 
        "教育特色": "「学力定着の徹底」。朝の学習支援や夏休みの「足立っ子学習塾」など学校外教育の補完が手厚い。学力調査の伸び率が都内トップ級。",
        "独自支援": "子供の貧困対策としての食支援や居場所づくりが先進的。私立高校等への授業料補助など経済的支援も手厚い。"
    },
    {
        "No": 22, "区": "葛飾区", 
        "教育特色": "23区初「学校給食費の完全無償化」を実施。校舎の耐震・改築率100%を達成済みで安全面も強く、ICT教育計画も着実に遂行。",
        "独自支援": "「マタニティパス」配布。第2子以降の保育料完全無償化。3人乗り自転車の購入費補助など、ファミリーの移動支援が特徴。"
    },
    {
        "No": 23, "区": "江戸川区", 
        "教育特色": "公立校の学童機能「すくすくスクール」は夜間まで対応可能で、働く親からの支持が絶大。スポーツ教育を通じた人格形成に注力。",
        "独自支援": "「乳児養育手当（月13,000円）」を1歳まで支給。独自の「孫育て」支援など、3世代同居を推進する施策も多い。"
    }
]

# --- ヘルパー関数 ---
def show_centered_table(df):
    st.write(df.to_html(index=False, escape=False, justify='center'), unsafe_allow_html=True)

# --- メインロジック ---
st.write("### 📍 エリアを選択してください")
df_ward = pd.DataFrame(ward_data)
ward_list = df_ward["区"].tolist()
selected_ward = st.selectbox("区を選択", ward_list, index=4, label_visibility="collapsed") 

ward_info = df_ward[df_ward["区"] == selected_ward].iloc[0]
st.markdown(f"""
    <div class="highlight-box">
        <h3 style="margin-top:0; color:#1a365d;">{selected_ward} の子育て環境（詳細）</h3>
        <p style="line-height:1.6;"><b>■ 教育・学校特色:</b><br>{ward_info['教育特色']}</p>
        <p style="line-height:1.6;"><b>■ 独自の自治体支援:</b><br>{ward_info['独自支援']}</p>
    </div>
""", unsafe_allow_html=True)

# --- 学校データ表示 ---
df_school = pd.DataFrame(school_data)
local_schools = df_school[df_school["所在地"].str.contains(selected_ward.replace("区",""), na=False)]

if not local_schools.empty:
    st.markdown(f"#### ✨ {selected_ward}内の難関校")
    show_centered_table(local_schools[["順位", "学校名", "偏差値", "カテゴリ", "最寄り"]])
else:
    st.info(f"※{selected_ward}内に所在する難関校（偏差値60以上）はリスト外です。通学圏内をご確認ください。")

st.markdown("---")
st.write("### 🏆 東京都 難関私立中学 TOP7 一覧")
col1, col2, col3 = st.columns(3)
with col1:
    st.markdown('<p style="color:#3498db; font-weight:bold; border-bottom:2px solid #3498db; text-align:center;">🟦 男子校</p>', unsafe_allow_html=True)
    show_centered_table(df_school[df_school["カテゴリ"] == "男子校"].sort_values("順位")[["順位", "学校名", "偏差値"]])
with col2:
    st.markdown('<p style="color:#e91e63; font-weight:bold; border-bottom:2px solid #e91e63; text-align:center;">🟥 女子校</p>', unsafe_allow_html=True)
    show_centered_table(df_school[df_school["カテゴリ"] == "女子校"].sort_values("順位")[["順位", "学校名", "偏差値"]])
with col3:
    st.markdown('<p style="color:#9b59b6; font-weight:bold; border-bottom:2px solid #9b59b6; text-align:center;">🟪 共学</p>', unsafe_allow_html=True)
    show_centered_table(df_school[df_school["カテゴリ"] == "共学"].sort_values("順位")[["順位", "学校名", "偏差値"]])
