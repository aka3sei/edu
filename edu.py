import streamlit as st
import pandas as pd

# 1. ページ設定
st.set_page_config(page_title="教育環境ナビ", layout="wide")

# CSS: デザイン調整
st.markdown("""
    <style>
    header { visibility: hidden; }
    .block-container { padding-top: 1rem !important; }
    .main-header { 
        font-size: 26px; font-weight: bold; color: #1a365d; 
        text-align: center; border-bottom: 3px solid #3498db;
        padding-bottom: 10px; margin-bottom: 20px; 
    }
    .highlight-box {
        background-color: #f8fafc;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e2e8f0;
        margin-bottom: 15px;
    }
    .table-title {
        font-size: 18px; font-weight: bold; margin-top: 30px; margin-bottom: 15px;
        text-align: center; color: #2c3e50; border-left: 5px solid #3498db; padding-left: 10px;
    }
    .sub-table-title {
        font-size: 16px; font-weight: bold; margin-top: 15px; margin-bottom: 10px;
        color: #1a365d;
    }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th { background-color: #f2f2f2; text-align: center !important; padding: 12px; font-size: 14px; border-bottom: 2px solid #ddd; }
    td { border-bottom: 1px solid #ddd; padding: 10px; text-align: center !important; font-size: 14px; }
    </style>
""", unsafe_allow_html=True)

st.markdown('<div class="main-header">🏫 東京 難関校・教育環境完全ガイド</div>', unsafe_allow_html=True)

# --- データ定義 ---
school_data = [
    {"順位": 1, "学校名": "開成中学校", "偏差値": 72, "カテゴリ": "男子校", "所在地": "荒川区", "最寄り": "西日暮里"},
    {"順位": 2, "学校名": "麻布中学校", "偏差値": 68, "カテゴリ": "男子校", "所在地": "港区", "最寄り": "広尾"},
    {"順位": 3, "学校名": "駒場東邦中学校", "偏差値": 67, "カテゴリ": "男子校", "所在地": "世田谷区", "最寄り": "駒場東大前"},
    {"順位": 4, "学校名": "武蔵中学校", "偏差値": 65, "カテゴリ": "男子校", "所在地": "練馬区", "最寄り": "江古田"},
    {"順位": 5, "学校名": "海城中学校", "偏差値": 64, "カテゴリ": "男子校", "所在地": "新宿区", "最寄り": "新大久保"},
    {"順位": 6, "学校名": "早稲田中学校", "偏差値": 64, "カテゴリ": "男子校", "所在地": "新宿区", "最寄り": "早稲田"},
    {"順位": 7, "学校名": "本郷中学校", "偏差値": 60, "カテゴリ": "男子校", "所在地": "豊島区", "最寄り": "巣鴨"},
    {"順位": 1, "学校名": "桜蔭中学校", "偏差値": 71, "カテゴリ": "女子校", "所在地": "文京区", "最寄り": "水道橋"},
    {"順位": 2, "学校名": "女子学院中学校", "偏差値": 69, "カテゴリ": "女子校", "所在地": "千代田区", "最寄り": "市ヶ谷"},
    {"順位": 3, "学校名": "豊島岡女子学園", "偏差値": 68, "カテゴリ": "女子校", "所在地": "豊島区", "最寄り": "池袋"},
    {"順位": 4, "学校名": "雙葉中学校", "偏差値": 67, "カテゴリ": "女子校", "所在地": "千代田区", "最寄り": "四ツ谷"},
    {"順位": 5, "学校名": "白百合学園", "偏差値": 64, "カテゴリ": "女子校", "所在地": "千代田区", "最寄り": "九段下"},
    {"順位": 6, "学校名": "吉祥女子中学校", "偏差値": 63, "カテゴリ": "女子校", "所在地": "武蔵野市", "最寄り": "吉祥寺"},
    {"順位": 7, "学校名": "鴎友学園女子", "偏差値": 62, "カテゴリ": "女子校", "所在地": "世田谷区", "最寄り": "宮の坂"},
    {"順位": 1, "学校名": "渋谷教育学園渋谷", "偏差値": 70, "カテゴリ": "共学", "所在地": "渋谷区", "最寄り": "渋谷"},
    {"順位": 2, "学校名": "筑波大学附属", "偏差値": 69, "カテゴリ": "共学", "所在地": "文京区", "最寄り": "護国寺"},
    {"順位": 3, "学校名": "広尾学園", "偏差値": 66, "カテゴリ": "共学", "所在地": "港区", "最寄り": "広尾"},
    {"順位": 4, "学校名": "慶應義塾中等部", "偏差値": 65, "カテゴリ": "共学", "所在地": "港区", "最寄り": "三田"},
    {"順位": 5, "学校名": "早稲田実業学校", "偏差値": 65, "カテゴリ": "共学", "所在地": "国分寺市", "最寄り": "国分寺"},
    {"順位": 6, "学校名": "芝浦工業大学附属", "偏差値": 62, "カテゴリ": "共学", "所在地": "江東区", "最寄り": "豊洲"},
    {"順位": 7, "学校名": "三田国際学園", "偏差値": 61, "カテゴリ": "共学", "所在地": "世田谷区", "最寄り": "用賀"},
]

univ_data = [
    {"順位": 1, "大学名": "東京大学", "偏差値": 73, "キャンパス": "本郷(文京区)", "所在地": "文京区"},
    {"順位": 2, "大学名": "一橋大学", "偏差値": 68, "キャンパス": "国立(国立市)", "所在地": "国立市"},
    {"順位": 3, "大学名": "東京工業大学", "偏差値": 67, "キャンパス": "大岡山(目黒区)", "所在地": "目黒区"},
    {"順位": 4, "大学名": "早稲田大学", "偏差値": 67, "キャンパス": "早稲田(新宿区)", "所在地": "新宿区"},
    {"順位": 5, "大学名": "慶應義塾大学", "偏差値": 67, "キャンパス": "三田(港区)", "所在地": "港区"},
    {"順位": 6, "大学名": "上智大学", "偏差値": 65, "キャンパス": "四ツ谷(千代田区)", "所在地": "千代田区"},
    {"順位": 7, "大学名": "東京外国語大学", "偏差値": 64, "キャンパス": "府中(府中市)", "所在地": "府中市"},
]

# 自治体基本データ
ward_list = [
    "千代田区", "中央区", "港区", "新宿区", "文京区", "台東区", "墨田区", "江東区", "品川区", 
    "目黒区", "大田区", "世田谷区", "渋谷区", "中野区", "杉並区", "豊島区", "北区", 
    "荒川区", "板橋区", "練馬区", "足立区", "葛飾区", "江戸川区", 
    "武蔵野市", "国分寺市", "国立市", "府中市"
]

ward_info_map = {
    "千代田区": {
        "特色": "ICT教育の世界的先進区。1人1台端末の早期導入、公立中高一貫の「九段中等教育学校」の人気が極めて高く、独自の論理的思考教育や国際理解教育をカリキュラムに組み込んでいます。区立図書館との連携による読書推進も盛んです。", 
        "支援": "「次世代育成手当」として高校生まで月額5000円を所得制限なしで支給。誕生祝金として最大4万5000円分を給付するなど、子育て世帯への経済的直接給付が非常に手厚いのが特徴です。"
    },
    "中央区": {
        "特色": "臨海部の人口急増に伴い「晴海西小学校」等の新設校を相次いで開校。全小学校で放課後の遊び場「プレディ」を実施し、共働き世帯を強力に支援。歴史ある名門小学校も多く、地域ぐるみの伝統文化教育も行われています。", 
        "支援": "「第2子以降の保育料完全無償化」を実施。新生児誕生時に3万円分のタクシー券やベビー用品等を選べるお祝い品制度があるほか、多胎児世帯への移動支援（タクシー代補助）なども先行して導入しています。"
    },
    "港区": {
        "特色": "「国際理解教育」に特化した教育課程。ネイティブ教員を多数配置し、英語でのコミュニケーション能力育成を重視。麻布、慶應中等部、広尾学園など都内屈指の難関校が狭い範囲に集まり、教育熱は日本最高峰。公立校の施設も非常に近代的です。", 
        "支援": "出産費用助成金が23区最高額の最大60万円。さらに私立幼稚園入園料補助金など、経済的にゆとりある世帯への支援も抜かりありません。また、港区独自の「子育て世帯等家賃助成」も検討されるなど、住環境への配慮が厚いです。"
    },
    "新宿区": {
        "特色": "海城、早稲田などの超名門男子校の集積地。公立校では日本語指導が必要な児童への「多言語・多文化共生教育」が極めて充実しており、スタディサプリ等を活用した個別最適な学びや、科学・文化体験学習にも注力しています。", 
        "支援": "夜間や休日に子供を一時的に預けられる「ショートステイ制度」が整っており、多忙な保護者を支援。不妊治療費への助成や、新生児の聴覚検査費用の全額公費負担など、医療・安全面での支援が特徴的です。"
    },
    "文京区": {
        "特色": "「教育の府」。東京大学、桜蔭、筑波大附属、学芸大附属など、日本の最高峰の学び場が集中。区立小学校の「3S1K」等に象徴される公立校の質の高さも圧倒的で、中学受験率が非常に高い学区が多数存在します。", 
        "支援": "「文京区版ネウボラ」による妊産婦への切れ目ない伴走支援が有名。不登校児童への「中核的な居場所づくり」を先行導入しているほか、子ども食堂への活動支援など、教育格差を埋めるためのソフト支援が充実しています。"
    },
    "台東区": {
        "特色": "上野の山に位置する博物館、美術館、動物園を「キャンパス」として活用した「本物の文化体験」教育を全校で実施。伝統工芸や下町文化を学ぶ体験学習も豊富で、五感を研ぎ澄ます教育に定評があります。", 
        "支援": "小学校・中学校の入学時にそれぞれ一律でお祝い金を支給する制度が人気。家賃負担を軽減する「子育て世帯住宅助成」があるほか、子供のインフルエンザ予防接種費用の全額助成など、健康支援も手厚いです。"
    },
    "墨田区": {
        "特色": "「ものづくり教育」を軸に、理数系教育と地場産業の連携を強化。最新のICT機器を備えた校舎への改築を急ピッチで進めており、木のぬくもりを感じる空間デザインを取り入れた学習環境づくりが評価されています。", 
        "支援": "「すみだ型ネウボラ」を拠点に、保健師や管理栄養士による食育相談が充実。私立幼稚園の入園料・保育料に対する区独自の補助金加算があり、第2子以降の保育料無償化も所得制限なしで実施しています。"
    },
    "江東区": {
        "特色": "湾岸エリアを中心に最新鋭の設備を備えた大規模校を整備。理数教育に非常に強く、芝浦工業大学附属中などの科学系教育機関と連携した特別授業や、ロボット・プログラミング教育に注力するモデル校が多いのが特徴です。", 
        "支援": "待機児童ゼロを達成。第2子以降の保育料を0歳から完全無償化し、所得制限もありません。全ての公立小中学校で「給食費の無償化」を実施しており、子育て世帯の固定費削減に大きく貢献しています。"
    },
    "品川区": {
        "特色": "日本で初めて「小中一貫教育」をシステム化した先駆者。4-3-2制の柔軟な区分で中1ギャップを解消。独自教科「市民科」では、地域課題を解決する思考力やプレゼンテーション能力を育成。広尾学園小石川などの新設難関校も注目されています。", 
        "支援": "「しながわネウボラ」を通じ、全ての妊婦に1万円相当の育児用品、出産後にさらに1万円分を配布。私立中学校の受験料を助成する制度（生活保護・準要保護世帯）など、教育の機会均等に配慮した支援があります。"
    },
    "目黒区": {
        "特色": "東京工業大学など高等教育機関が近接。公立校では「思考力の可視化」を目指したデジタル教科書と電子黒板の積極活用が進んでいます。世帯年収が高く、塾への依存度が低い学校独自のハイレベルな発展学習に取り組む姿勢が見られます。", 
        "支援": "「子育て支援センター・ほっぺ」などの拠点が充実し、産後ケアの助成回数が他区より多いのが特徴。不妊去勢手術への助成といった独自の環境・動物愛護活動への意識も高く、品格のある街づくりと教育が融合しています。"
    },
    "大田区": {
        "特色": "「ものづくりの町」を活かし、地元企業のエンジニアが講師を務める理数教育や、羽田空港をテーマにした体験型学習が盛ん。放課後子供教室「おおたっ子ひろば」は全校で実施され、多様な世代との交流を重視しています。", 
        "支援": "「子育てひろば・ぴよぴよ」を各所に設置し、孤立しない子育てを支援。第3子以降が誕生した際に出産祝金を支給する制度があるほか、認可外保育施設を利用する場合の保育料助成が他区に比べて手厚い傾向にあります。"
    },
    "世田谷区": {
        "特色": "都内最大の人口を抱える住宅街。駒場東邦、鴎友学園、三田国際など多種多様な難関校が点在。公立校では「世田谷9年教育」を推進し、不登校特例校「ねいろ」の開校など、多様な子供のニーズに応える教育の先駆者です。", 
        "支援": "「せたがや子育て利用券」を全妊婦に配布（2万円分）。児童館の設置数は23区最多で、子供の遊び場の確保に並々ならぬ力を入れています。産後ケアセンターの草分け的存在であり、メンタルケア支援が非常に充実しています。"
    },
    "渋谷区": {
        "特色": "「渋谷教育学園渋谷」を筆頭に、IT・スタートアップ文化と融合したクリエイティブ教育が強み。全児童生徒にセルラー版iPadを1人1台配布し、学校内外を問わないICT学習環境を実現。プログラミング教育の先進校も多いです。", 
        "支援": "「ハッピーマザー出産助成金」として、一律10万円を区独自に上乗せ給付（合計60万円）。育児用品のレンタル補助や、保育園の第2子以降無償化など、共働き現役世代が最も恩恵を感じる施策を次々と投入しています。"
    },
    "中野区": {
        "特色": "「中野四季の都市」周辺に大学キャンパスが集積し、産学公連携の教育が活発。公立校ではラーニングコモンズ（共有学習空間）の整備を進め、対話型の探究学習を重視。情報モラル教育にも定評があります。", 
        "支援": "「子育て応援ギフト」として妊娠・出産時に計10万円相当を給付。さらに1歳の誕生日にも独自ギフトを贈呈。2歳児の歯科検診や、セカンドブック（絵本配布）事業など、子供の成長に合わせたきめ細かな支援が目立ちます。"
    },
    "杉並区": {
        "特色": "「少人数授業」を徹底。教育意識が極めて高い住民層に支えられ、中学受験率は23区トップクラス。自由な校風の学校が多く、体験活動やボランティア活動を単位化するなど、市民性の育成に重きを置いています。", 
        "支援": "「すぎなみ子育て応援券」が全国的にも有名。一時預かり、ベビーマッサージ、産前産後ケア等に使えるチケットを最大4万円分発行し、地域の多様なサービスを気軽に利用できる仕組みを構築しています。"
    },
    "豊島区": {
        "特色": "豊島岡、本郷など難関進学校が集まる。公立校では「学習支援スキップ」を放課後に全校で実施し、大学生ボランティアが補習を支援。SDGs教育や「国際アート・カルチャー都市」としての表現教育にも注力しています。", 
        "支援": "第2子以降の保育料無償化を所得制限なしで実施。待機児童ゼロを継続中。池袋周辺の公園を「子供が主役」の空間へ再開発（IKE・SUNPARK等）するなど、ハード面での子育て環境整備に成功しています。"
    },
    "北区": {
        "特色": "独自の「北区学習診断テスト」により、子供の弱点を分析し個別指導に反映。公立小中学校の給食費完全無償化を23区内でいち早く決断し、経済的負担を軽減。「渋沢栄一」の精神を学ぶ道徳教育も盛んです。", 
        "支援": "「安心ママパパ応援団」により、家事・育児支援を安価（1時間500円等）で提供。多胎児世帯への手厚い家事代行支援や、第3子以降の学校給食費・保育料の完全無償化を強力に推進しています。"
    },
    "荒川区": {
        "特色": "「開成中学校」のお膝元であり、区全体で「読書のまち」を標榜。学校図書館に専任の司書を配置。全国学力調査での伸び率が都内でも高く、地道な基礎学力向上策（荒川メソッド）が実を結んでいます。", 
        "支援": "中学生の保護者向けに「塾代助成制度」を所得制限付きで実施。布おむつや紙おむつ専用のゴミ袋を無料配布するほか、独自の入学準備金の前倒し支給など、実益重視の支援が揃っています。"
    },
    "板橋区": {
        "特色": "「板橋区版レッジョ・エミリア幼児教育」を提唱。子供の主体性を引き出す教育で全国から注目。公立校のコミュニティスクール化が全校で完了しており、地域住民が授業や放課後の学習支援に深く関わっています。", 
        "支援": "「すくすくカード」で有料の保育サービスを安価に受けられるほか、公園内での「プレーパーク」活動が盛ん。子供が泥だらけになって遊べる自由な環境を守る活動に区が積極的に関与しています。"
    },
    "練馬区": {
        "特色": "「武蔵中学校」がある緑豊かな学園都市。公立小中学校数は23区最多を誇り、大規模な教育ネットワークを展開。「読み・書き・計算」の徹底した基礎教育と、最先端のプログラミング教育をバランスよく両立させています。", 
        "支援": "「第3子誕生祝金10万円」を支給。幼稚園での預かり保育「練馬こども園」の認定を拡大し、保育園同等の長時間預かりを実現。家賃補助や不妊治療支援など、現役世代の流出を防ぐ手厚い施策が特徴です。"
    },
    "足立区": {
        "特色": "「足立っ子学習塾」として、放課後や夏休みに徹底した補習教育を提供し、学力格差の是正に成功。ICT教育でもモデル校を多数指定。中学受験を目指す層向けの「学力上位層向け特別講座」なども独自に開催しています。", 
        "支援": "「貧困対策」の先進自治体として、就学援助の基準を広げ、経済的に困難な家庭を強力にバックアップ。産前・産後タクシー助成金や、私立高校授業料に対する区独自の給付型奨学金制度も充実しています。"
    },
    "葛飾区": {
        "特色": "23区で初めて「学校給食費の完全無償化」を所得制限なしで実現。校舎の耐震改築率100%を早期に達成し、災害に強く清潔な学習環境を担保。伝統芸能（太鼓や舞）の継承教育も盛んです。", 
        "支援": "妊娠時に「マタニティパス（交通系ICカード1万円分）」を配布。さらに、3人乗り電動自転車の購入費用助成（最大4万円）など、下町の細い道を移動する子育て世帯に即した独自の支援があります。"
    },
    "江戸川区": {
        "特色": "全小学校で「すくすくスクール」を実施し、放課後に地域のボランティアと子供が共に学ぶ環境を提供。スポーツ教育が非常に盛んで、心身の成長と礼儀を重視する風土があります。1人あたりの公園面積が広く、自然教育も盛ん。", 
        "支援": "独自の「乳児養育手当」として、0歳児を家庭で育てる世帯に月額1万3000円を支給。また、24時間365日の子育て相談ダイヤルの設置や、保育ママ制度の充実など、在宅育児への理解が深いのが特徴です。"
    },
    "武蔵野市": {
        "特色": "文教都市の象徴。吉祥女子など名門校が多く、コミュニティが成熟。公立校では「1人1台端末」を表現活動に昇華させた「武蔵野スタイル」の授業を展開。市民参加型の授業が多く、地域全体で子供を育てる意識が極めて高い。", 
        "支援": "地域見守り体制「こども110番」の密度が極めて高く、防犯面での安心感が抜群。独自の奨学金制度や、保育料の負担軽減策も早期から導入。不登校児童への「適応指導教室」の質の高さにも定評があります。"
    },
    "国分寺市": {
        "特色": "早稲田実業学校をはじめ、名門私立と豊かな自然が共存。公立校では「名水・遺跡」を活かしたフィールドワーク学習や、理数系教育に注力。生徒の知的好奇心を刺激する独自の探究プログラムが豊富です。", 
        "支援": "子育てアプリ「ぶんじっこ」による情報提供や、産後サポート「産後ケア」事業が充実。住宅街の緑地を活かした子供の遊び場「こくぶんじプレーパーク」の常設など、自然派教育志向の世帯を支援しています。"
    },
    "国立市": {
        "特色": "一橋大学を中心とした日本屈指の文教都市。景観条例により「大学通りの教育環境」を厳格に保護。公立校でも芸術・教養教育のレベルが高く、保護者の協力度・参画意識が都内でも随一です。", 
        "支援": "「産前産後ケア」の質が高く、地域住民（シルバー世代）による子育てヘルパー派遣が浸透。教育費への補助だけでなく、心にゆとりを持って育児ができる「環境の維持」そのものを最大の支援としています。"
    },
    "府中市": {
        "特色": "東京外国語大学などの教育機関が集まり、国際的な視野を養う授業が活発。スポーツ施設が非常に充実しており、ラグビーや野球を通じた人格形成教育が盛ん。広大な公園での野外体験学習も積極的に取り入れられています。", 
        "支援": "子育て世帯への経済的支援が非常に安定しており、第2子以降の保育料無料化や、独自の「出産・子育て応援交付金」によるサポートが手厚いです。公共施設（図書館・体育館）の子供向けプログラムの充実度は多摩地域トップクラス。"
    }
}

# --- ロジック ---
df_mid = pd.DataFrame(school_data)
df_univ = pd.DataFrame(univ_data)

# 星付き名称の生成
def get_star_name(w):
    c = len(df_mid[df_mid["所在地"] == w]) + len(df_univ[df_univ["所在地"] == w])
    return f"{w}{'★' * c}"

ward_options = [get_star_name(w) for w in ward_list]

# 共通表示関数
def show_centered_table(df):
    st.write(df.to_html(index=False, escape=False, justify='center'), unsafe_allow_html=True)

# 1. 📍 エリア選択
st.write("### 📍 エリアを選択して教育情報をチェック")
selected_option = st.selectbox("自治体を選択", ward_options, index=4, label_visibility="collapsed")
selected_ward_raw = selected_option.split("★")[0]

# 自治体情報表示
info = ward_info_map.get(selected_ward_raw, {"特色": "ICT教育や地域連携を推進。", "支援": "各ライフステージに合わせた支援。"})
st.markdown(f"""
    <div class="highlight-box">
        <h3 style="margin-top:0; color:#1a365d;">{selected_option} の教育・子育て</h3>
        <p><b>■ 教育特色:</b> {info['特色']}</p>
        <p><b>■ 独自支援:</b> {info['支援']}</p>
    </div>
""", unsafe_allow_html=True)

# 選択された区の学校一覧
local_mids = df_mid[df_mid["所在地"] == selected_ward_raw]
local_univs = df_univ[df_univ["所在地"] == selected_ward_raw]

if not local_mids.empty:
    st.markdown(f'<div class="sub-table-title">✨ {selected_ward_raw}内の難関中学校</div>', unsafe_allow_html=True)
    show_centered_table(local_mids[["順位", "学校名", "偏差値", "カテゴリ", "最寄り"]])

if not local_univs.empty:
    st.markdown(f'<div class="sub-table-title">🎓 {selected_ward_raw}内の難関大学</div>', unsafe_allow_html=True)
    show_centered_table(local_univs[["順位", "大学名", "偏差値", "キャンパス"]])

st.markdown("---")

# 2. 🏆 中学ランキング（常時表示）
st.markdown('<div class="table-title">🏆 東京都 難関私立中学ランキング</div>', unsafe_allow_html=True)
col1, col2, col3 = st.columns(3)
with col1:
    st.markdown('<p style="color:#3498db; font-weight:bold; text-align:center;">🟦 男子校 TOP7</p>', unsafe_allow_html=True)
    show_centered_table(df_mid[df_mid["カテゴリ"] == "男子校"].sort_values("順位")[["順位", "学校名", "偏差値"]])
with col2:
    st.markdown('<p style="color:#e91e63; font-weight:bold; text-align:center;">🟥 女子校 TOP7</p>', unsafe_allow_html=True)
    show_centered_table(df_mid[df_mid["カテゴリ"] == "女子校"].sort_values("順位")[["順位", "学校名", "偏差値"]])
with col3:
    st.markdown('<p style="color:#9b59b6; font-weight:bold; text-align:center;">🟪 共学 TOP7</p>', unsafe_allow_html=True)
    show_centered_table(df_mid[df_mid["カテゴリ"] == "共学"].sort_values("順位")[["順位", "学校名", "偏差値"]])

# 3. 🎓 大学ランキング（常時表示・中学の下に配置）
st.markdown('<div class="table-title">🎓 東京都 難関大学偏差値ランキング TOP7</div>', unsafe_allow_html=True)
show_centered_table(df_univ[["順位", "大学名", "偏差値", "キャンパス"]])
