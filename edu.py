import streamlit as st
import pandas as pd

# 1. ページ設定
st.set_page_config(page_title="学区・教育環境ナビ", layout="wide")

# CSS: デザイン維持
st.markdown("""
    <style>
    header { visibility: hidden; }
    .block-container { padding-top: 1rem !important; overflow: visible !important; }
    .main-header { 
        font-size: 24px; font-weight: bold; color: #1a365d; 
        text-align: center; border-bottom: 3px solid #3498db;
        padding-bottom: 10px; margin-bottom: 15px; 
    }
    .highlight-box {
        background-color: #f8fafc;
        padding: 20px;
        border-radius: 12px;
        border: 2px solid #e2e8f0;
        margin-bottom: 20px;
    }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th { background-color: #f2f2f2; text-align: center !important; padding: 10px; font-size: 14px; border-bottom: 2px solid #ddd; }
    td { border-bottom: 1px solid #ddd; padding: 10px; text-align: center !important; font-size: 14px; }
    </style>
""", unsafe_allow_html=True)

st.markdown('<div class="main-header">🏫 学区・教育環境ガイド（中学・大学版）</div>', unsafe_allow_html=True)

# --- 中学データ (21校) ---
school_data = [
    {"学校名": "開成中学校", "所在地": "荒川区", "カテゴリ": "中学"},
    {"学校名": "麻布中学校", "所在地": "港区", "カテゴリ": "中学"},
    {"学校名": "駒場東邦中学校", "所在地": "世田谷区", "カテゴリ": "中学"},
    {"学校名": "武蔵中学校", "所在地": "練馬区", "カテゴリ": "中学"},
    {"学校名": "海城中学校", "所在地": "新宿区", "カテゴリ": "中学"},
    {"学校名": "早稲田中学校", "所在地": "新宿区", "カテゴリ": "中学"},
    {"学校名": "本郷中学校", "所在地": "豊島区", "カテゴリ": "中学"},
    {"学校名": "桜蔭中学校", "所在地": "文京区", "カテゴリ": "中学"},
    {"学校名": "女子学院中学校", "所在地": "千代田区", "カテゴリ": "中学"},
    {"学校名": "豊島岡女子学園", "所在地": "豊島区", "カテゴリ": "中学"},
    {"学校名": "雙葉中学校", "所在地": "千代田区", "カテゴリ": "中学"},
    {"学校名": "白百合学園", "所在地": "千代田区", "カテゴリ": "中学"},
    {"学校名": "吉祥女子中学校", "所在地": "武蔵野市", "カテゴリ": "中学"},
    {"学校名": "鴎友学園女子", "所在地": "世田谷区", "カテゴリ": "中学"},
    {"学校名": "渋谷教育学園渋谷", "所在地": "渋谷区", "カテゴリ": "中学"},
    {"学校名": "筑波大学附属", "所在地": "文京区", "カテゴリ": "中学"},
    {"学校名": "広尾学園", "所在地": "港区", "カテゴリ": "中学"},
    {"学校名": "慶應義塾中等部", "所在地": "港区", "カテゴリ": "中学"},
    {"学校名": "早稲田実業学校", "所在地": "国分寺市", "カテゴリ": "中学"},
    {"学校名": "芝浦工業大学附属", "所在地": "江東区", "カテゴリ": "中学"},
    {"学校名": "三田国際学園", "所在地": "世田谷区", "カテゴリ": "中学"},
]

# --- 大学データ (TOP7) ---
univ_data = [
    {"順位": 1, "大学名": "東京大学", "偏差値": 73, "キャンパス": "文京区", "所在地": "文京区"},
    {"順位": 2, "大学名": "一橋大学", "偏差値": 68, "キャンパス": "国立市", "所在地": "国立市"},
    {"順位": 3, "大学名": "東京工業大学", "偏差値": 67, "キャンパス": "目黒区", "所在地": "目黒区"},
    {"順位": 4, "大学名": "早稲田大学", "偏差値": 67, "キャンパス": "新宿区", "所在地": "新宿区"},
    {"順位": 5, "大学名": "慶應義塾大学", "偏差値": 67, "キャンパス": "港区", "所在地": "港区"},
    {"順位": 6, "大学名": "上智大学", "偏差値": 65, "キャンパス": "千代田区", "所在地": "千代田区"},
    {"順位": 7, "大学名": "東京外国語大学", "偏差値": 64, "キャンパス": "府中市", "所在地": "府中市"},
]

# --- 自治体データ (国立市・府中市を追加) ---
base_ward_data = [
    {"区": "千代田区", "教育特色": "ICT教育先進区。九段中等教育学校が人気。", "独自支援": "次世代育成手当月5000円支給。"},
    {"区": "中央区", "教育特色": "晴海エリア校舎新設。放課後遊び場「プレディ」全校実施。", "独自支援": "第2子以降保育料完全無償化。"},
    {"区": "港区", "教育特色": "英語教育に注力。独自の小中一貫校が充実。", "独自支援": "出産費用助成最大60万円。"},
    {"区": "新宿区", "教育特色": "日本語指導フォロー手厚い。スタディサプリ導入。", "独自支援": "子どもショートステイ制度。"},
    {"区": "文京区", "教育特色": "教育の府。公立小レベル都内最高峰。東大のお膝元。", "独自支援": "文京区版ネウボラ伴走支援。"},
    {"区": "台東区", "教育特色": "上野の文化資源を活用した体験教育が豊富。", "独自支援": "入学お祝い金支給制度。"},
    {"区": "墨田区", "教育特色": "ものづくり教育。最新校舎への改築推進中。", "独自支援": "すみだ型ネウボラ支援。"},
    {"区": "江東区", "教育特色": "湾岸エリアの最新設備。理数教育に注力。", "独自支援": "待機児童ゼロ達成区。"},
    {"区": "品川区", "教育特色": "小中一貫教育の先駆。独自教科「市民科」。", "独自支援": "育児用品配布ネウボラ。"},
    {"区": "目黒区", "教育特色": "電子黒板完備。東工大など高等教育機関も隣接。", "独自支援": "子育て支援センター「ほっぺ」。"},
    {"区": "大田区", "教育特色": "町工場連携の理数教育。放課後ひろば実施。", "独自支援": "子育てひろば「ぴよぴよ」。"},
    {"区": "世田谷区", "教育特色": "児童館数最多。独自の日本語教育。文教地区。", "独自支援": "せたがや子育て利用券。"},
    {"区": "渋谷区", "教育特色": "1人1台iPad。プログラミング教育に強み。", "独自支援": "ハッピーマザー助成金。"},
    {"区": "中野区", "教育特色": "情報モラル教育。ラーニングコモンズ整備。", "独自支援": "子育て応援ギフト計10万円。"},
    {"区": "杉並区", "教育特色": "少人数授業徹底。中学受験率が高い。", "独自支援": "すぎなみ子育て応援券。"},
    {"区": "豊島区", "教育特色": "スキップ学習支援。SDGs人材育成重視。", "独自支援": "第2子以降保育料無償化。"},
    {"区": "北区", "教育特色": "学習診断テスト導入。給食費無償化。", "独自支援": "安心ママパパ応援団。"},
    {"区": "荒川区", "教育特色": "読書のまち。開成中を擁する教育環境。", "独自支援": "塾代助成制度（中学生）。"},
    {"区": "板橋区", "教育特色": "レッジョ・エミリア幼児教育。プレーパーク。", "独自支援": "すくすくカード。"},
    {"区": "練馬区", "教育特色": "公立校数最多。読み書き計算とICTのバランス。", "独自支援": "第3子誕生祝金10万円。"},
    {"区": "足立区", "教育特色": "足立っ子学習塾。学力伸び率都内随一。", "独自支援": "貧困対策・食支援の先進区。"},
    {"区": "葛飾区", "教育特色": "給食費完全無償化。校舎改築率100%。", "独自支援": "マタニティパス。"},
    {"区": "江戸川区", "教育特色": "すくすくスクール。乳児養育手当が独自。", "独自支援": "乳児養育手当月1.3万円。"},
    {"区": "武蔵野市", "教育特色": "文教地区。市民性教育を重視。", "独自支援": "地域見守り体制が強固。"},
    {"区": "国分寺市", "教育特色": "早実等の名門校。理数・フィールド学習。", "独自支援": "子育てアプリ・産後サポート。"},
    {"区": "国立市", "教育特色": "国立大学通りを中心とした学園都市。一橋大を擁する。", "独自支援": "景観と教育環境維持への意識が高い。"},
    {"区": "府中市", "教育特色": "東京外大等の教育機関。スポーツ教育も盛ん。", "独自支援": "子育て世帯への経済的支援が安定。"}
]

# --- ロジック ---
df_mid = pd.DataFrame(school_data)
df_univ = pd.DataFrame(univ_data)
df_ward = pd.DataFrame(base_ward_data)

# 星のカウント (中学 + 大学)
def get_star_ward_name(ward_name):
    count_mid = len(df_mid[df_mid["所在地"] == ward_name])
    count_univ = len(df_univ[df_univ["所在地"] == ward_name])
    total = count_mid + count_univ
    return f"{ward_name}{'★' * total}"

ward_options = [get_star_ward_name(w) for w in df_ward["区"]]

# 選択
st.write("### 📍 エリアを選択してください")
selected_option = st.selectbox("自治体を選択", ward_options, index=4, label_visibility="collapsed")
selected_ward_raw = selected_option.split("★")[0]

ward_info = df_ward[df_ward["区"] == selected_ward_raw].iloc[0]
st.markdown(f"""
    <div class="highlight-box">
        <h3 style="margin-top:0; color:#1a365d;">{selected_option} の教育・子育て</h3>
        <p><b>■ 教育特色:</b> {ward_info['教育特色']}</p>
        <p><b>■ 独自支援:</b> {ward_info['独自支援']}</p>
    </div>
""", unsafe_allow_html=True)

# -----------------------------------
# 大学ランキングセクションの追加
# -----------------------------------
st.markdown("---")
st.write("### 🎓 東京都 難関大学偏差値 TOP7")

# 表表示用
def show_centered_table(df):
    st.write(df.to_html(index=False, escape=False, justify='center'), unsafe_allow_html=True)

# 大学テーブル表示
show_centered_table(df_univ[["順位", "大学名", "偏差値", "キャンパス"]])

st.markdown("---")
st.write("### 🏆 難関私立中学 TOP21 一覧（参考）")
# 以前の3カラム中学表示（省略して簡潔に表示も可能ですが、これまでの構成を維持）
col1, col2, col3 = st.columns(3)
# (以下、中学データの表示ロジックを継続)
